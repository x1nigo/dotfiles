#! /bin/sh

# Display the following:
# 📶: wifi running w/ strength
# 📡: no wifi connection
# 🌐: connected to ethernet
# ❎: no ethernet connection

if grep -xq 'up' /sys/class/net/wl*/operstate 2>/dev/null; then
	wlicon="$(awk '/wl/ {print "📶", int($3 * 100 / 70) }' /proc/net/wireless)% "
elif grep -xq 'down' /sys/class/net/wl*/operstate 2>/dev/null; then
	grep -xq '0x1003' /sys/class/net/wl*/flags && wlicon="📡" || wlicon="❌"
fi

case $BUTTON in
        1) st -e nmtui ;;
        3) active=$(nmcli -t -f name connection show --active)
                if [ -z $active ]; then
                        notify-send "🧭 Network module:" "Unable to connect to the internet.

📜 Legend:
📶: connected to wifi
📡: no wifi connection
🌎: connected to ethernet
❎: no ethernet connection
❌: wifi disabled"
                else
                        notify-send "🧭 Network module:" "Connected to: '$(nmcli -t -f name connection show --active)'

📜 Legend:
📶: connected to wifi
📡: no wifi connection
🌎: connected to ethernet
❎: no ethernet connection
❌: wifi disabled"
                fi ;;
        5) st -e $EDITOR ${XDG_CONFIG_HOME:-$HOME/.config}/dwmblocks/blocks.h ;;
esac

printf "%s%s\n" "$wlicon" "$(sed 's/down/❎/;s/up/🌐/' /sys/class/net/e*/operstate 2>/dev/null)"

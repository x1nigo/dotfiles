#! /bin/sh

# As of now, this module really only works with only one (1) active torrent.
# TODO: Create a script that an handle multiple instances of torrents.
# (quit possible `tremc` or `stig` from the AUR.

if ! pidof transmission-daemon >/dev/null 2>&1; then
	transmission-daemon && notify-send "ğŸŒ± Starting torrent daemon..."
fi

case $BUTTON in
	1) setsid -f ${TERMINAL:-st} -e stig ;;
        3) notify-send "ğŸŒ‘ğŸŒ± Torrent module:" "\[Click to open \`stig\` program.\]
ğŸ›‘ paused
ğŸ•°ï¸ idle
â¬†ï¸ uploading
â¬‡ï¸ downloading
âœ… done
ğŸŒ± seeding" ;;
        5) st -e $EDITOR ${XDG_CONFIG_HOME:-$HOME/.config}/dwmblocks/blocks.h ;;
esac

active=$(transmission-remote -l | grep %)
[ -z $active ] && printf "ğŸŒ‘ğŸŒ±" && exit 1

transmission-remote -l | grep % |
	sed " # The letters are for sorting and will not appear.
	s/.*Stopped.*/A ğŸ›‘/;
	s/.*Seeding.*/Z ğŸŒ±/;
	s/.*100%.*/N âœ…/;
	s/.*Idle.*/B ğŸ•°ï¸/;
	s/.*Uploading.*/L â¬†ï¸/;
	s/.*%.*/M â¬‡ï¸/" |
		sort -h | uniq -c | awk '{print $3 $1}' | paste -sd ' ' -

#! /bin/sh

# As of now, this module really only works
# with only one (1) active torrent.
# If there are more, the notifications
# would get skewered.

# Variables
name="$(transmission-remote -t all -i | grep 'Name:')"
state="$(transmission-remote -t all -i | grep 'State:')"
percent="$(transmission-remote -t all -i | grep 'Percent Done:')"
speed="$(transmission-remote -t all -i | grep 'Download Speed:')"

case $BUTTON in
	1) notify-send "$name" "$state
$percent
$speed" ;;
        3) notify-send "🌑🌱 Torrent module:" "
📜 Legend:
🛑: Paused
🕰️: Idle
🔼: Uploading
♻️: Downloading
✅: Done
🌱: Seeding
🌑: No torrents" ;;
        5) st -e $EDITOR ${XDG_CONFIG_HOME:-$HOME/.config}/dwmblocks/blocks.h ;;
esac

active=$(transmission-remote -l | grep %)
[ -z $active ] && printf "🌑🌱" && exit 1

transmission-remote -l | grep % |
        sed "s/.*Stopped.*/🛑/;s/.*Seeding.*/🌱/;s/.*100%.*/✅/;s/.*Idle.*/🕰️/;s/.*Uploading.*/🔼/;s/.*%.*/♻️$percent/"
	sort -h | uniq -c | awk '{print $2 $1}' | paste -sd ' ' -
